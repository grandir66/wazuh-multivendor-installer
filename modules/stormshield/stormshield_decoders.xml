<!-- Stormshield Firewall Decoders for Wazuh -->
<!-- https://github.com/grandir66/wazuh-multivendor-installer -->
<!-- Rule IDs: 100400-100499 -->

<!-- Main Stormshield decoder -->
<decoder name="stormshield">
  <prematch>id=firewall</prematch>
</decoder>

<!-- Alarm logs - simpler regex -->
<decoder name="stormshield-alarm">
  <parent>stormshield</parent>
  <prematch>logtype="alarm"</prematch>
  <regex offset="after_parent">time="(\.+)" fw="(\S+)"</regex>
  <order>time,fw</order>
</decoder>

<decoder name="stormshield-alarm2">
  <parent>stormshield</parent>
  <prematch>logtype="alarm"</prematch>
  <regex>src=(\d+\.\d+\.\d+\.\d+) srcport=(\d+)\p*\s\S+\s\S+\sdst=(\d+\.\d+\.\d+\.\d+) dstport=(\d+)</regex>
  <order>srcip,srcport,dstip,dstport</order>
</decoder>

<decoder name="stormshield-alarm3">
  <parent>stormshield</parent>
  <prematch>logtype="alarm"</prematch>
  <regex>action=(\w+) msg="(\.+)" class</regex>
  <order>stormshield_action,msg</order>
</decoder>

<decoder name="stormshield-alarm4">
  <parent>stormshield</parent>
  <prematch>logtype="alarm"</prematch>
  <regex>alarmid=(\d+)</regex>
  <order>alarmid</order>
</decoder>

<decoder name="stormshield-alarm5">
  <parent>stormshield</parent>
  <prematch>logtype="alarm"</prematch>
  <regex>pri=(\d+)</regex>
  <order>pri</order>
</decoder>

<!-- Fallback for other logs -->
<decoder name="stormshield-generic">
  <parent>stormshield</parent>
  <regex offset="after_parent">time="(\.+)" fw="(\S+)"</regex>
  <order>time,fw</order>
</decoder>
