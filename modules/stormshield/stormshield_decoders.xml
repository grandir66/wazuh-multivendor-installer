<!-- Stormshield Firewall Decoders for Wazuh -->
<!-- https://github.com/grandir66/wazuh-multivendor-installer -->
<!-- Supports both RFC5424+WELF and pure WELF formats -->
<!-- Rule IDs: 100400-100499 -->

<!-- Main Stormshield decoder - matches WELF format -->
<decoder name="stormshield">
  <prematch>id=firewall</prematch>
</decoder>

<!-- Extract core fields -->
<decoder name="stormshield-fields">
  <parent>stormshield</parent>
  <regex offset="after_parent">time="(\d+-\d+-\d+ \d+:\d+:\d+)" fw="(\S+)"</regex>
  <order>time, fw</order>
</decoder>

<!-- Extract network traffic fields for filter/connection logs -->
<decoder name="stormshield-traffic">
  <parent>stormshield</parent>
  <regex> src=(\d+.\d+.\d+.\d+) srcport=(\d+)\S* \S+ dst=(\d+.\d+.\d+.\d+) dstport=(\d+)</regex>
  <order>srcip, srcport, dstip, dstport</order>
</decoder>

<!-- Extract action -->
<decoder name="stormshield-action">
  <parent>stormshield</parent>
  <regex> action=(\w+) </regex>
  <order>stormshield_action</order>
</decoder>

<!-- Extract message -->
<decoder name="stormshield-msg">
  <parent>stormshield</parent>
  <regex> msg="([^"]+)"</regex>
  <order>msg</order>
</decoder>

<!-- Extract logtype -->
<decoder name="stormshield-logtype">
  <parent>stormshield</parent>
  <regex> logtype="(\w+)"</regex>
  <order>logtype</order>
</decoder>

<!-- Extract priority -->
<decoder name="stormshield-pri">
  <parent>stormshield</parent>
  <regex> pri=(\d+) </regex>
  <order>pri</order>
</decoder>

<!-- Extract protocol -->
<decoder name="stormshield-proto">
  <parent>stormshield</parent>
  <regex> ipproto=(\w+) </regex>
  <order>ipproto</order>
</decoder>

<!-- Extract interfaces -->
<decoder name="stormshield-srcif">
  <parent>stormshield</parent>
  <regex> srcifname="([^"]+)"</regex>
  <order>srcifname</order>
</decoder>

<decoder name="stormshield-dstif">
  <parent>stormshield</parent>
  <regex> dstifname="([^"]+)"</regex>
  <order>dstifname</order>
</decoder>

<!-- Extract alarm fields -->
<decoder name="stormshield-alarm">
  <parent>stormshield</parent>
  <regex> alarmid=(\d+) </regex>
  <order>alarmid</order>
</decoder>

<decoder name="stormshield-class">
  <parent>stormshield</parent>
  <regex> class=(\w+) </regex>
  <order>class</order>
</decoder>

<!-- Extract user for auth logs -->
<decoder name="stormshield-user">
  <parent>stormshield</parent>
  <regex> user="([^"]+)"</regex>
  <order>user</order>
</decoder>

<!-- Extract address for auth logs -->
<decoder name="stormshield-address">
  <parent>stormshield</parent>
  <regex> address=(\S+) </regex>
  <order>address</order>
</decoder>

<!-- Extract error code -->
<decoder name="stormshield-error">
  <parent>stormshield</parent>
  <regex> error=(\d+)</regex>
  <order>error</order>
</decoder>

<!-- Extract rule info -->
<decoder name="stormshield-ruleid">
  <parent>stormshield</parent>
  <regex> ruleid=(\d+) </regex>
  <order>ruleid</order>
</decoder>

<decoder name="stormshield-rulename">
  <parent>stormshield</parent>
  <regex> rulename="([^"]+)"</regex>
  <order>rulename</order>
</decoder>

<!-- Extract VPN fields -->
<decoder name="stormshield-tunnel">
  <parent>stormshield</parent>
  <regex> tunnel="([^"]+)"</regex>
  <order>tunnel</order>
</decoder>

<decoder name="stormshield-phase">
  <parent>stormshield</parent>
  <regex> phase=(\d+) </regex>
  <order>phase</order>
</decoder>

<!-- Extract traffic stats -->
<decoder name="stormshield-sent">
  <parent>stormshield</parent>
  <regex> sent=(\d+) </regex>
  <order>sent</order>
</decoder>

<decoder name="stormshield-rcvd">
  <parent>stormshield</parent>
  <regex> rcvd=(\d+) </regex>
  <order>rcvd</order>
</decoder>

<!-- Extract country -->
<decoder name="stormshield-country">
  <parent>stormshield</parent>
  <regex> srccountry="(\w+)"</regex>
  <order>srccountry</order>
</decoder>

<!-- Extract MAC -->
<decoder name="stormshield-mac">
  <parent>stormshield</parent>
  <regex> srcmac=(\S+) </regex>
  <order>srcmac</order>
</decoder>
