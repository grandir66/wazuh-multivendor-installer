<!-- Stormshield Firewall Decoders for Wazuh -->
<!-- https://github.com/grandir66/wazuh-multivendor-installer -->
<!-- Rule IDs: 100400-100499 -->

<!-- Main Stormshield decoder -->
<decoder name="stormshield">
  <prematch>id=firewall</prematch>
</decoder>

<!-- Core fields: time and fw -->
<decoder name="stormshield1">
  <parent>stormshield</parent>
  <regex offset="after_parent"> time="(\d+-\d+-\d+ \d+:\d+:\d+)" fw="(\S+)"</regex>
  <order>time, fw</order>
</decoder>

<!-- Network: src, srcport, dst, dstport -->
<decoder name="stormshield2">
  <parent>stormshield</parent>
  <regex> src=(\d+\.\d+\.\d+\.\d+) srcport=(\d+)\.+ dst=(\d+\.\d+\.\d+\.\d+) dstport=(\d+)</regex>
  <order>srcip, srcport, dstip, dstport</order>
</decoder>

<!-- Action and message -->
<decoder name="stormshield3">
  <parent>stormshield</parent>
  <regex> action=(\w+) msg="([^"]+)"</regex>
  <order>stormshield_action, msg</order>
</decoder>

<!-- Alarm fields -->
<decoder name="stormshield4">
  <parent>stormshield</parent>
  <regex> class=(\w+) classification=(\d+) alarmid=(\d+)</regex>
  <order>class, classification, alarmid</order>
</decoder>

<!-- Logtype -->
<decoder name="stormshield5">
  <parent>stormshield</parent>
  <regex> logtype="(\w+)"</regex>
  <order>logtype</order>
</decoder>

<!-- Priority and protocol -->
<decoder name="stormshield6">
  <parent>stormshield</parent>
  <regex> pri=(\d+) \.+ ipproto=(\w+)</regex>
  <order>pri, ipproto</order>
</decoder>

<!-- Interfaces -->
<decoder name="stormshield7">
  <parent>stormshield</parent>
  <regex> srcifname="([^"]+)"\.+ dstifname="([^"]+)"</regex>
  <order>srcifname, dstifname</order>
</decoder>

<!-- Rule info -->
<decoder name="stormshield8">
  <parent>stormshield</parent>
  <regex> ruleid=(\d+) rulename="([^"]+)"</regex>
  <order>ruleid, rulename</order>
</decoder>

<!-- Auth: user and address -->
<decoder name="stormshield9">
  <parent>stormshield</parent>
  <regex> user="([^"]+)"\.* address=(\S+)</regex>
  <order>user, address</order>
</decoder>

<!-- Auth: user only -->
<decoder name="stormshield10">
  <parent>stormshield</parent>
  <regex> user="([^"]+)"</regex>
  <order>user</order>
</decoder>

<!-- Error -->
<decoder name="stormshield11">
  <parent>stormshield</parent>
  <regex> error=(\d+)</regex>
  <order>error</order>
</decoder>

<!-- VPN tunnel -->
<decoder name="stormshield12">
  <parent>stormshield</parent>
  <regex> tunnel="([^"]+)"</regex>
  <order>tunnel</order>
</decoder>

<!-- VPN phase -->
<decoder name="stormshield13">
  <parent>stormshield</parent>
  <regex> phase=(\d+)</regex>
  <order>phase</order>
</decoder>

<!-- Country -->
<decoder name="stormshield14">
  <parent>stormshield</parent>
  <regex> dstcountry="(\w+)"</regex>
  <order>dstcountry</order>
</decoder>

<decoder name="stormshield15">
  <parent>stormshield</parent>
  <regex> srccountry="(\w+)"</regex>
  <order>srccountry</order>
</decoder>
