<!-- Stormshield Firewall Decoders for Wazuh -->
<!-- https://github.com/grandir66/wazuh-multivendor-installer -->
<!-- Rule IDs: 100400-100499 -->

<!-- Main Stormshield decoder - matches WELF format -->
<decoder name="stormshield">
  <prematch>id=firewall</prematch>
</decoder>

<!-- Extract all main fields in one decoder using accumulate -->
<decoder name="stormshield-core">
  <parent>stormshield</parent>
  <regex offset="after_parent"> time="(\d+-\d+-\d+ \d+:\d+:\d+)" fw="(\S+)"</regex>
  <order>time, fw</order>
</decoder>

<decoder name="stormshield-src">
  <parent>stormshield</parent>
  <regex> src=(\d+.\d+.\d+.\d+) srcport=(\d+)</regex>
  <order>srcip, srcport</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-dst">
  <parent>stormshield</parent>
  <regex> dst=(\d+.\d+.\d+.\d+) dstport=(\d+)</regex>
  <order>dstip, dstport</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-action">
  <parent>stormshield</parent>
  <regex> action=(\w+) </regex>
  <order>stormshield_action</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-msg">
  <parent>stormshield</parent>
  <regex> msg="([^"]+)"</regex>
  <order>msg</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-logtype">
  <parent>stormshield</parent>
  <regex> logtype="(\w+)"</regex>
  <order>logtype</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-pri">
  <parent>stormshield</parent>
  <regex> pri=(\d+) </regex>
  <order>pri</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-proto">
  <parent>stormshield</parent>
  <regex> ipproto=(\w+) </regex>
  <order>ipproto</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-srcifname">
  <parent>stormshield</parent>
  <regex> srcifname="([^"]+)"</regex>
  <order>srcifname</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-dstifname">
  <parent>stormshield</parent>
  <regex> dstifname="([^"]+)"</regex>
  <order>dstifname</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-alarmid">
  <parent>stormshield</parent>
  <regex> alarmid=(\d+) </regex>
  <order>alarmid</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-class">
  <parent>stormshield</parent>
  <regex> class=(\w+) </regex>
  <order>class</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-ruleid">
  <parent>stormshield</parent>
  <regex> ruleid=(\d+) </regex>
  <order>ruleid</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-rulename">
  <parent>stormshield</parent>
  <regex> rulename="([^"]+)"</regex>
  <order>rulename</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-user">
  <parent>stormshield</parent>
  <regex> user="([^"]+)"</regex>
  <order>user</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-address">
  <parent>stormshield</parent>
  <regex> address=(\S+) </regex>
  <order>address</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-error">
  <parent>stormshield</parent>
  <regex> error=(\d+)</regex>
  <order>error</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-tunnel">
  <parent>stormshield</parent>
  <regex> tunnel="([^"]+)"</regex>
  <order>tunnel</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-phase">
  <parent>stormshield</parent>
  <regex> phase=(\d+) </regex>
  <order>phase</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-srcmac">
  <parent>stormshield</parent>
  <regex> srcmac=(\S+) </regex>
  <order>srcmac</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-dstcountry">
  <parent>stormshield</parent>
  <regex> dstcountry="(\w+)"</regex>
  <order>dstcountry</order>
  <accumulate/>
</decoder>

<decoder name="stormshield-srccountry">
  <parent>stormshield</parent>
  <regex> srccountry="(\w+)"</regex>
  <order>srccountry</order>
  <accumulate/>
</decoder>
