# Stormshield Firewall rsyslog configuration
# Receives logs on UDP port 5514, cleans them, writes to file for Wazuh

module(load="imudp")
input(type="imudp" port="5514" ruleset="stormshield")

# Template to extract clean WELF content (removes RFC5424 header and BOM)
template(name="StormshieldClean" type="string" 
    string="%msg:R,ERE,1:id=firewall (.*)--end:1%\n")

ruleset(name="stormshield") {
    action(type="omfile" 
           file="/var/log/stormshield/stormshield.log" 
           template="StormshieldClean"
           fileOwner="syslog"
           fileGroup="syslog"
           fileCreateMode="0644"
           dirOwner="syslog"
           dirGroup="syslog"
           dirCreateMode="0755")
    stop
}
