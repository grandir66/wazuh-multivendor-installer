# Stormshield Firewall rsyslog configuration
# Receives logs on UDP port 5514, outputs JSON format for Wazuh

module(load="imudp")
input(type="imudp" port="5514" ruleset="stormshield")

# Template to output as JSON - extracts key=value pairs
template(name="StormshieldJSON" type="list") {
    constant(value="{\"stormshield\":")
    property(name="msg" regex.expression="id=firewall (.*)" regex.type="ERE" regex.submatch="1" format="jsonf")
    constant(value="}\n")
}

# Alternative: just output clean WELF for simpler parsing
template(name="StormshieldClean" type="string" 
    string="%msg:R,ERE,1:id=firewall (.*)--end:1%\n")

ruleset(name="stormshield") {
    action(type="omfile" 
           file="/var/log/stormshield/stormshield.log" 
           template="StormshieldClean"
           fileOwner="syslog"
           fileGroup="syslog"
           fileCreateMode="0644")
    stop
}
